<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReadWise | 線上書籍推薦系統</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    
</head>
<body>

    <header>
        <div class="container header-content">
            <h1 class="logo">ReadWise <span>書籍推薦</span></h1>
            
            <div class="user-area">
                <div id="user-info" class="hidden">
                    <span id="user-name">使用者</span>
                    <button id="logout-btn" class="btn-secondary">登出</button>
                </div>
                <button id="login-btn" class="btn-primary">Google 登入</button>
            </div>
        </div>
    </header>

    <section id="recommendation-section" class="container">
        <h2 class="section-title">✨ 為您推薦</h2>
        <div id="recommendation-container" class="recommendation-grid">
            <div class="loading-placeholder">正在計算推薦...</div>
        </div>
    </section>

    <section class="controls container">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="搜尋書名、作者或關鍵字...">
            <span class="search-icon">🔍</span>
        </div>
        
        <div class="filters">
            <button class="filter-btn active" data-category="all">全部</button>
            <button class="filter-btn" data-category="科技">科技</button>
            <button class="filter-btn" data-category="自我成長">自我成長</button>
            <button class="filter-btn" data-category="設計">設計</button>
            <button class="filter-btn" data-category="文學">文學</button>
            <button class="filter-btn" id="show-favorites-btn">❤️ 我的收藏</button>
        </div>
    </section>

    <main class="container">
        <div id="loading" class="loading">正在連線至雲端圖書館...</div>
        <!-- 修改處開頭 -->
        <div id="book-grid" class="book-grid">
            <% if (books.length === 0) { %>
                <div class="empty-state">目前沒有書籍資料。</div>
            <% } else { %>
                <% books.forEach(function(book) { %>
                    <article class="book-card" onclick="openModalById('<%= book.id %>')">
                        <button class="card-like-btn" data-id="<%= book.id %>">🤍</button>
                        
                        <img src="<%= book.image && book.image.startsWith('http') ? book.image : 'https://placehold.co/300x450/EEE/31343C?text=No+Cover' %>" 
                            alt="<%= book.title %>" class="book-image" loading="lazy">
                        
                        <div class="book-info">
                            <span class="book-category"><%= book.category || '未分類' %></span>
                            <h3 class="book-title"><%= book.title %></h3>
                            <p class="book-author">作者：<%= book.author %></p>
                            <div class="book-rating">★ <%= book.rating %></div>
                        </div>
                    </article>
                <% }); %>
            <% } %>
        </div>
        <script>
            window.initialBooksData = <%- JSON.stringify(books) %>;
        </script>
        <!-- 修改處結尾 -->

        <div id="empty-state" class="empty-state hidden">
            <h3>找不到相關書籍 📚</h3>
            <p>試試看調整關鍵字，或瀏覽其他分類。</p>
        </div>
    </main>

    <div id="book-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div class="modal-body">
                <img id="modal-img" src="" alt="Book Cover">
                <div class="modal-details">
                    <span id="modal-category" class="book-category">CATEGORY</span>
                    <h2 id="modal-title">Book Title</h2>
                    <p id="modal-author">Author Name</p>
                    <div id="modal-rating" class="book-rating">★ 4.8</div>
                    <p id="modal-desc">Description goes here...</p>
                    <div id="modal-tags" class="tags"></div>
                    <button id="modal-like-btn" class="like-action-btn">
                        🤍 加入收藏
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 ReadWise Book Recommendation System. Powered by Firebase.</p>
        <button id="admin-upload-btn" style="opacity: 0.2; font-size: 10px;">匯入預設書籍</button>
    </footer>
    <script type="module" src="/script.js"></script>
</body>

</html>
